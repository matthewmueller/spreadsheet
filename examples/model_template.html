<!doctype html>
<html>
<head>
  <title>spreadsheet component</title>
  <link rel="stylesheet" href="../build/build.css">
  <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1">
  <style>
    .spreadsheet {
      max-width: 1500px;
    }
    table {
      /*border-collapse: collapse;*/
      font-size: 7.5pt;
      text-align: right;

    }

    table .headers {
      text-align: left;
    }


    table td {
      /*border: 1px solid #ccc;*/
      padding: 5px;
    }

    table th {
      max-width: 60px;
    }

    .header {
      font-weight: normal;
      font-style: italic;
      font-family: Arial;

    }

    .col_merge {
      text-align: center;
      font-weight: bold;
      border-bottom: solid black 1px !important;
    }

    .rating {
      text-align: center;
      font-weight: bold;
      color: green !important;
    }


  </style>
</head>
<body>
  <h1 style="font-family:verdana; font-size:10pt">LR Model Template</h1>
  <script src="../build/build.js" type="text/javascript"></script>
  <script type="text/javascript">
    var Spreadsheet = require('spreadsheet');
    var spreadsheet = Spreadsheet();
    document.body.appendChild(spreadsheet.el);
    

    // inputs
    var company_name = 'Amazon';
    var valuation_date = 41788; // excel date

    var trading_price = 336.37;

    var EBITDA_exit = 37.1;
    var rev_exit = 2;
    var growth_exit = .05;
    var pe_exit = 50;
    
    var discount_rate = .11;


    // balance sheet inputs
    var debt = 6904;
    var interest_rate = .0253864426419467;
    var tax_rate = .35;
    var dep_prior_ppe = .302;
    var lastest_nwc = -5929;
    var fiscal_year_end_nwc = -9066;

    var equity_waterfall = [0, 0, -48, 0, -6904, 8666];
    var shares_outstanding = 475.8674;

    var change_in_ltm_nwc = 5929;
    var change_in_ytd_nwc = -3137;

    var lastest_ppe = 12267;


    // enter excel dates
    // [LTM, FY+1, FY+2, FY+3, FY+4, FY+5]
    var ltm_num_dates = [41729];
    var proj_num_dates =  [42004, 42369, 42735, 43100, 43465];

    
    // enter text dates
    var hist_text_dates = ['Dec-09', 'Dec-10', 'Dec-11', 'Dec-12', 'Dec-13', '', 'Mar-13', 'Mar-14', 'Mar-14'];
    var proj_text_dates = ['Dec-14', 'Dec-15', 'Dec-16', 'Dec-17', 'Dec-18'];

    
    // enter text periods
    var hist_period_text_dates = ['FY 09', 'FY 10', 'FY 11', 'FY 12', 'FY 13', '', 'YTD Prior', 'YTD', 'LTM'];
    var proj_period_text_dates = ['FY 14', 'FY 15', 'FY 16', 'FY 17', 'FY 18'];

    
    // income statment inputs
    var rev_title_1 = 'Net Product Sales';
    var rev_title_2 = 'Net Service Sales';
    var rev_title_3 = 'Rev 3';
    var rev_title_4 = 'Rev 4';
    var rev_title_5 = 'Rev 5';
    var rev_title_6 = 'Rev 6';
    var rev_title_7 = 'Rev 7';

    
    // historical revenue growth by segment
      // [FY-4, FY-3, FY-2, FY-1, FY, space, YTD Prior, YTD]
    var hist_rev_fin_1 = [22273, 30792, 42000, 51733, 60903, 11249, 13271, 15705];
    var hist_rev_fin_2 = [2236, 3412, 6077, 9360, 13549, 1937, 2799, 4036];
    var hist_rev_fin_3 = [0, 0, 0, 0, 0, 0, 0, 0];
    var hist_rev_fin_4 = [0, 0, 0, 0, 0, 0, 0, 0];
    var hist_rev_fin_5 = [0, 0, 0, 0, 0, 0, 0, 0];
    var hist_rev_fin_6 = [0, 0, 0, 0, 0, 0, 0, 0];
    var hist_rev_fin_7 = [0, 0, 0, 0, 0, 0, 0, 0];

    
    // historical cogs, sg&a, d&a, and capex
    var hist_cogs_fin = [-18978, -26561, -37288, -45971, -54181, '', -11801, -14055];
    var hist_sga_fin = [-4402, -6237, -9927, -14446, -19526, '', -4088, -5540];
    var hist_da_fin = [378, 568, 1083, 2159, 3253, '', 700, 1010];

    
    // ytd [dep, amort]
    var hist_ltm_da = [-3731, -168];
    var hist_ytd_da = [-968, -42];
    var hist_capex_fin = [373, 979, 1811, 3785, 3444, '', 670, 1080];

    
    // all segments
    var ytd_prior_rev_growth = [0.17975, 0.44525, 0, 0, 0, 0, 0, 0.22111];
    var ltm_rev_growth = [0.17975, 0.44525, 0, 0, 0, 0, 0, 0.22111];

    
    // interest expense
    var ltm_interest_exp = -150;
    var ytd_interest_exp = -42;

      // projected inputs
      var proj_rev_growth_1 = [0.178, 0.178, 0.178, 0.178, 0.178];
      var proj_rev_growth_2 = [0.447, 0.447, 0.447, 0.447, 0.447];
      var proj_rev_growth_3 = [0,0,0,0,0,0];
      var proj_rev_growth_4 = [0,0,0,0,0,0];
      var proj_rev_growth_5 = [0,0,0,0,0,0];
      var proj_rev_growth_6 = [0,0,0,0,0,0];
      var proj_rev_growth_7 = [0,0,0,0,0,0];

      var proj_total_rev_growth = [0.227, 0.236, 0.246, 0.257, 0.269];
      var proj_gp_margin = [0.295, 0.3, 0.305, 0.31, 0.315];
      var proj_sga_margin = [0.268, 0.268, 0.268, 0.268, 0.268];
      var proj_ebit_margin = [0.027, 0.032, 0.037, 0.042, 0.047];
      var proj_capex_margin = [0.049, 0.045, 0.04, 0.035, 0.035];
      var proj_nwc = [-0.1, -0.1, -0.1, -0.1, -0.1];

    // spreadsheet.el.querySelector('thead').style.display = 'none';

    // spreadsheet
    spreadsheet.select('A1:Q126').fill()
    // spreadsheet.classes.add('headings');
      // .select('B1, C1, D1, E1').insert(['Revenues', 'Expenses', 'Profit', 'Total']).addClass('header')
      // .select('A2:A9').insert(years([1, 2, 3, 4, 5, 6, 7, 8])).addClass('header')
      // .select('E2:E9').calc(':C - :D').format('$')
      // .select('B2:B9').insert([10, 12, 32, 43, 53, 23, 32, 43]).format('$').editable()
      // .select('C2:C9').insert([32, 11, 22, 33, 45, 42, 10, 32]).format('$').editable()
      // .select('D2:D9').calc(':B - :C').format('$')
      // .select('A1:A49').insert([''])
    
    // column titles
    spreadsheet.select('A').width(150)
    spreadsheet.select('A1:A65').addClass('headers')
      .insert(['', 
               '', 
               '', 
               '', 
               '', 
               '',
               company_name + ' Model',
              '',
              'Growth Assumptions:',
              rev_title_1 + ' Growth',
              rev_title_2 + ' Growth',
              rev_title_3 + ' Growth',
              rev_title_4 + ' Growth',
              rev_title_5 + ' Growth',
              rev_title_6 + ' Growth',
              rev_title_7 + ' Growth',
              'Total Revenue Growth',
              '',
              'Implied Forecast:',
              '  '+rev_title_1,
              '  '+rev_title_2,                                
              '  '+rev_title_3,
              '  '+rev_title_4,
              '  '+rev_title_5,
              '  '+rev_title_6,
              '  '+rev_title_7,
              'Total Revenue',
              'Growth',
              '',
              'Cost of Goods',
              '',
              'Gross Profit',
              'GP Margin',
              '',
              'SG&A Expenses',
              '% of Revenue',
              '',
              'EBIT',
              'EBIT Margin',
              '',
              '(+) D&A',
              '',
              'EBITDA',
              'EBITDA Margin',
              '',
              'Capital Expenditures',
              '% of Revenue',
              '',
              'Stock Price Analysis',
              '',
              'Valuation Date',
              '',
              '5-Year Exit Method',
              '',
              'Use Method (Y to Use, N to Ignore)',
              '',
              'Exit in Year 5 at',
              'Assumed Discount Rate',
              'Implied Fair Value per Share',
              'Current Trading Price',
              '',
              ' Discount/(Premium) to Current Price',
              '',
              'Your Rating',
              ''])

    spreadsheet.select('A1:P1').insert(['A', 'B', 'C', 'D', 'E', 'F', 'G', 'H', 'I',
                                        'J', 'K', 'L', 'M', 'N', 'O', 'P'])

    // merged rows
    spreadsheet.select('L4:P4').merge().insert(['Projections']).addClass('col_merge')

    // historical date titles
      // excel number of days entered
    spreadsheet.select('J5').insert(ltm_num_dates)
    spreadsheet.select('L5:P5').insert(proj_num_dates)

      // text date format entered
    spreadsheet.select('B6:J6').insert(hist_text_dates)
    spreadsheet.select('L6:P6').insert(proj_text_dates)

      // text period format entered
    spreadsheet.select('B7:J7').insert(hist_period_text_dates)
    spreadsheet.select('L7:P7').insert(proj_period_text_dates)

    // revenue input historical
    spreadsheet.select('B20:I20').insert(hist_rev_fin_1).format('$')
    spreadsheet.select('B21:I21').insert(hist_rev_fin_2).format('$')
    spreadsheet.select('B22:I22').insert(hist_rev_fin_3).format('$')
    spreadsheet.select('B23:I23').insert(hist_rev_fin_4).format('$')
    spreadsheet.select('B24:I24').insert(hist_rev_fin_5).format('$')
    spreadsheet.select('B25:I25').insert(hist_rev_fin_6).format('$')
    spreadsheet.select('B26:I26').insert(hist_rev_fin_7).format('$')
    spreadsheet.select('J20:J26').calc('{I} + {F} - {H}').format('$')
    
    // revenue totals sum historical
    spreadsheet.select('B27:J27').calc('{20} + {21} + {22} + {23} + {24} + {25} + {26}').format('$')

    // segment and total growth calculate historical
    spreadsheet.select('C10').calc('{C20} / {B20} - 1').format('%')
    spreadsheet.select('C11').calc('{C21} / {B21} - 1').format('%')
    spreadsheet.select('C12').calc('{C22} / {B22} - 1').format('%')
    spreadsheet.select('C13').calc('{C23} / {B23} - 1').format('%')
    spreadsheet.select('C14').calc('{C24} / {B24} - 1').format('%')
    spreadsheet.select('C15').calc('{C25} / {B25} - 1').format('%')
    spreadsheet.select('C16').calc('{C26} / {B26} - 1').format('%')
    spreadsheet.select('C17').calc('{C27} / {B27} - 1').format('%')

    spreadsheet.select('D10').calc('{D20} / {C20} - 1').format('%')
    spreadsheet.select('D11').calc('{D21} / {C21} - 1').format('%')
    spreadsheet.select('D12').calc('{D22} / {C22} - 1').format('%')
    spreadsheet.select('D13').calc('{D23} / {C23} - 1').format('%')
    spreadsheet.select('D14').calc('{D24} / {C24} - 1').format('%')
    spreadsheet.select('D15').calc('{D25} / {C25} - 1').format('%')
    spreadsheet.select('D16').calc('{D26} / {C26} - 1').format('%')
    spreadsheet.select('D17').calc('{D27} / {C27} - 1').format('%')

    spreadsheet.select('E10').calc('{E20} / {D20} - 1').format('%')
    spreadsheet.select('E11').calc('{E21} / {D21} - 1').format('%')
    spreadsheet.select('E12').calc('{E22} / {D22} - 1').format('%')
    spreadsheet.select('E13').calc('{E23} / {D23} - 1').format('%')
    spreadsheet.select('E14').calc('{E24} / {D24} - 1').format('%')
    spreadsheet.select('E15').calc('{E25} / {D25} - 1').format('%')
    spreadsheet.select('E16').calc('{E26} / {D26} - 1').format('%')
    spreadsheet.select('E17').calc('{E27} / {D27} - 1').format('%')

    spreadsheet.select('F10').calc('{F20} / {E20} - 1').format('%')
    spreadsheet.select('F11').calc('{F21} / {E21} - 1').format('%')
    spreadsheet.select('F12').calc('{F22} / {E22} - 1').format('%')
    spreadsheet.select('F13').calc('{F23} / {E23} - 1').format('%')
    spreadsheet.select('F14').calc('{F24} / {E24} - 1').format('%')
    spreadsheet.select('F15').calc('{F25} / {E25} - 1').format('%')
    spreadsheet.select('F16').calc('{F26} / {E26} - 1').format('%')
    spreadsheet.select('F17').calc('{F27} / {E27} - 1').format('%')

    spreadsheet.select('H10:H17').insert(ytd_prior_rev_growth).format('%')
    spreadsheet.select('H28').insert(ytd_prior_rev_growth[ytd_prior_rev_growth.length-1]).format('%')

    spreadsheet.select('I10').calc('{I20} / {H20} - 1').format('%')
    spreadsheet.select('I11').calc('{I21} / {H21} - 1').format('%')
    spreadsheet.select('I12').calc('{I22} / {H22} - 1').format('%')
    spreadsheet.select('I13').calc('{I23} / {H23} - 1').format('%')
    spreadsheet.select('I14').calc('{I24} / {H24} - 1').format('%')
    spreadsheet.select('I15').calc('{I25} / {H25} - 1').format('%')
    spreadsheet.select('I16').calc('{I26} / {H26} - 1').format('%')
    spreadsheet.select('I17').calc('{I27} / {H27} - 1').format('%')

    spreadsheet.select('J10:J17').insert(ltm_rev_growth).format('%')

    // total revenue growth rates below
    spreadsheet.select('C28').calc('{C27} / {B27} - 1').format('%')
    spreadsheet.select('D28').calc('{D27} / {C27} - 1').format('%')
    spreadsheet.select('E28').calc('{E27} / {D27} - 1').format('%')
    spreadsheet.select('F28').calc('{F27} / {E27} - 1').format('%')
    spreadsheet.select('I28').calc('{I27} / {H27} - 1').format('%')
    spreadsheet.select('J28').insert(ltm_rev_growth[ltm_rev_growth.length-1]).format('%')

    //// projected revenue inputs
      spreadsheet.select('L28:P28').insert(proj_total_rev_growth).editable().format('%')
      spreadsheet.select('L27').calc('({L28}+1) * {F27}').format('$')
      spreadsheet.select('M27').calc('({M28}+1) * {L27}').format('$')
      spreadsheet.select('N27').calc('({N28}+1) * {M27}').format('$')
      spreadsheet.select('O27').calc('({O28}+1) * {N27}').format('$')
      spreadsheet.select('P27').calc('({P28}+1) * {O27}').format('$')

    // cogs
    spreadsheet.select('B30:I30').insert(hist_cogs_fin).format('$')
    spreadsheet.select('J30').calc('{F} + {I} - {H}').format('$')

    //// projected cogs
    spreadsheet.select('L30:P30').calc('{32} - {27}').format('$')

    // gp
    spreadsheet.select('B32:F32').calc('{27} + {30}').format('$')
    spreadsheet.select('H32:J32').calc('{27} + {30}').format('$')
    spreadsheet.select('B33:F33').calc('{32} / {27}').format('%')
    spreadsheet.select('H33:J33').calc('{32} / {27}').format('%')

    //// projected gp inputs
      spreadsheet.select('L33:P33').insert(proj_gp_margin).editable().format('%')
      spreadsheet.select('L32').calc('{L27} * {L33}').format('$')
      spreadsheet.select('M32').calc('{M27} * {M33}').format('$')
      spreadsheet.select('N32').calc('{N27} * {N33}').format('$')
      spreadsheet.select('O32').calc('{O27} * {O33}').format('$')
      spreadsheet.select('P32').calc('{P27} * {P33}').format('$')


    // sga
    spreadsheet.select('B35:I35').insert(hist_sga_fin).format('$')
    spreadsheet.select('J35').calc('{F} + {I} - {H}').format('$')
    spreadsheet.select('B36:F36').calc('-{35} / {27}').format('%')
    spreadsheet.select('H36:J36').calc('-{35} / {27}').format('%')

    //// projected sga inputs
      spreadsheet.select('L36:P36').insert(proj_sga_margin).editable().format('%')
      spreadsheet.select('L35').calc('-{L27} * {L36}').format('$')
      spreadsheet.select('M35').calc('-{M27} * {M36}').format('$')
      spreadsheet.select('N35').calc('-{N27} * {N36}').format('$')
      spreadsheet.select('O35').calc('-{O27} * {O36}').format('$')
      spreadsheet.select('P35').calc('-{P27} * {P36}').format('$')

    // ebit
    spreadsheet.select('B38:F38').calc('{32} + {35}').format('$')
    spreadsheet.select('H38:J38').calc('{32} + {35}').format('$')
    spreadsheet.select('B39:F39').calc('{38} / {27}').format('%')
    spreadsheet.select('H39:J39').calc('{38} / {27}').format('%')

    //// projected ebit inputs
      spreadsheet.select('L39:P39').insert(proj_ebit_margin).editable().format('%')
      spreadsheet.select('L38').calc('{L27} * {L39}').format('$')
      spreadsheet.select('M38').calc('{M27} * {M39}').format('$')
      spreadsheet.select('N38').calc('{N27} * {N39}').format('$')
      spreadsheet.select('O38').calc('{O27} * {O39}').format('$')
      spreadsheet.select('P38').calc('{P27} * {P39}').format('$')

    // d&a
    spreadsheet.select('B41:I41').insert(hist_da_fin).format('$')
    spreadsheet.select('J41').calc('{F} + {I} - {H}').format('$')

    //// projected d&a
      spreadsheet.select('L41:P41').calc('{104}').format('$')

    // ebitda
    spreadsheet.select('B43:F43').calc('{38} + {41}').format('$')
    spreadsheet.select('H43:J43').calc('{38} + {41}').format('$')
    spreadsheet.select('B44:F44').calc('{43} / {27}').format('%')
    spreadsheet.select('H44:J44').calc('{43} / {27}').format('%')

    //// projected ebitda calc
    spreadsheet.select('L43:P43').calc('{41} + {38}').format('$')
    spreadsheet.select('L44:P44').calc('{43} / {27}').format('%')

    // capex
    spreadsheet.select('B46:I46').insert(hist_capex_fin).format('$')
    spreadsheet.select('J46').calc('{F} + {I} - {H}').format('$')

    spreadsheet.select('B47:F47').calc('{46} / {27}').format('%')
    spreadsheet.select('H47:J47').calc('{46} / {27}').format('%')

    //// projected capex inputs
      spreadsheet.select('L47:P47').insert(proj_capex_margin).editable().format('%')
      spreadsheet.select('L46').calc('{L27} * {L47}').format('$')
      spreadsheet.select('M46').calc('{M27} * {M47}').format('$')
      spreadsheet.select('N46').calc('{N27} * {N47}').format('$')
      spreadsheet.select('O46').calc('{O27} * {O47}').format('$')
      spreadsheet.select('P46').calc('{P27} * {P47}').format('$')

// ***************************************************************
// Calculation Details and Methodology
// ***************************************************************

  // financial statement assumptions
    spreadsheet.select('A66:A130').addClass('headers')
      .insert(['',
               '',
               'Calculation Details and Methodology',
               'Financial Statement Assumptions',
               '',
               '',
               'Implied Forecast',
               '',
               'Total Revenue',
               'COGS + SG&A Expenses',
               'EBIT',
               'Interest Expense',
               'Current Trading Price',
               'Pro forma Tax Expense',
               'Adjusted Net Income',
               '',
               'Net Working Capital',
               '% of Revenue',
               '',
               'Depreciation Schedule',
               'Depreciation',
               'Amortization',
               '',
               'PP&E',
               '',
               '',
               '',
               'NOL Beginning Balance',
               '  (+) Additions',
               '  (-) Usage',
               'NOL Ending Balance',
               '',
               'Discounted Cash Flow Analysis',
               '',
               'Implied Forecast',
               'EBIT',
               '  (-) Pro forma Tax Expense',
               'NOPAT',
               '  (+) Depreciation and Amortization',
               '  (-) Investment in Working Capital',
               '  (-) Capital Expenditures',
               'Unlevered Free Cash Flow',
               '',
               '',
               'DCF Periods',
               'Discount Factor (Middle of Period)',
               'Discount Factor (End of Period)',
               '',
               'Fair Value per Share Reconcilation',
               '',
               '',
               '',
               'Present Value of Discrete Cash Flow',
               'Present Value of Terminal Cash Flow',
               'Enterprise Value',
               '  (+) Unconsolidated Investments',
               '  (+) Deferred Revenue Adj',
               '  (+/-) Other',
               '  (-) Non-controlling Interests',
               '  (-) Debt',
               '  (+) Cash',
               'Equity Value',
               '  (x) Diluted Shares Outstanding (Mil)',
               'Estimated Fair Value per Share',
               ''])
    
    spreadsheet.select('J51').insert(valuation_date)
    spreadsheet.select('J53').insert('EBITDA Multiple')
    spreadsheet.select('L53').insert('Revenue Multiple')
    spreadsheet.select('M53').insert('Terminal Growth Rate')
    spreadsheet.select('N53').insert('P/E Multiple')

    spreadsheet.select('J55:N55').insert(['Y', '', 'Y', 'Y', 'Y'])
    spreadsheet.select('J57').insert([EBITDA_exit]).editable()
    spreadsheet.select('L57').insert([rev_exit]).editable()
    spreadsheet.select('M57').insert([growth_exit]).format('%').editable()
    spreadsheet.select('N57').insert([pe_exit]).editable()

    spreadsheet.select('J58').insert([discount_rate]).editable().format('%')
    spreadsheet.select('L58:N58').calc('{J58}').format('%')

    spreadsheet.select('J59').calc('{J129}').format('$')
    spreadsheet.select('L59:N59').calc('{129}').format('$')

    spreadsheet.select('J60').insert([trading_price]).format('$')
    spreadsheet.select('L60:N60').calc('{J60}').format('$')

    spreadsheet.select('J62').calc('{J59} / {J60} - 1').format('%')
    spreadsheet.select('L62:N62').calc('{59} / {60} - 1').format('%')

    spreadsheet.select('J64:L64').merge().insert('BUY').addClass('rating')

    // headers
    // merged rows
    spreadsheet.select('L70:P70').merge().insert(['Implied Projection']).addClass('col_merge')

      // text date format entered
    spreadsheet.select('H71:J71').insert([hist_text_dates[7], hist_text_dates[7], 'Rest of'])
    spreadsheet.select('L71:P71').insert(proj_text_dates)

      // text period format entered
    spreadsheet.select('H72:J72').insert([hist_period_text_dates[8], hist_period_text_dates[7], proj_period_text_dates[0]])
    spreadsheet.select('L72:P72').insert(proj_period_text_dates)

    // additional inputs
    spreadsheet.select('F74').insert('Current Debt')
    spreadsheet.select('F75').insert(debt).editable().format('$')

    spreadsheet.select('F76').insert('Interest Rate')
    spreadsheet.select('F77').insert(interest_rate).editable().format('%')

    spreadsheet.select('F78').insert('Tax Rate')
    spreadsheet.select('F79').insert(tax_rate).editable().format('%')

    spreadsheet.select('F85').insert('Dep % of Prior PP&E')
    spreadsheet.select('F86').insert(dep_prior_ppe).editable().format('%')

    // revenue
    spreadsheet.select('H74').insert('Current Debt')
    spreadsheet.select('F75').insert(debt).editable().format('$')

    spreadsheet.select('F76').insert('Interest Rate')
    spreadsheet.select('F77').insert(interest_rate).editable().format('%')

    spreadsheet.select('F78').insert('Tax Rate')
    spreadsheet.select('F79').insert(tax_rate).editable().format('%')

    spreadsheet.select('F85').insert('Dep % of Prior PP&E')
    spreadsheet.select('F86').insert(dep_prior_ppe).editable().format('%')

    // ltm column
    spreadsheet.select('H74').calc('{J27}').format('$')
    spreadsheet.select('H75').calc('{J30} + {J35}').format('$')
    spreadsheet.select('H76').calc('{H74} + {H75}').format('$')
    spreadsheet.select('H77').insert(ltm_interest_exp).format('$')
    spreadsheet.select('H78').calc('{H76} + {H77}').format('$')
    spreadsheet.select('H79').calc('-(Math.max({H78} * {F79}, 0))').format('$')
    spreadsheet.select('H80').calc('{H78} + {H79}').format('$')

    // ytd column
    spreadsheet.select('I74').calc('{I27}').format('$')
    spreadsheet.select('I75').calc('{I30} + {I35}').format('$')
    spreadsheet.select('I76').calc('{I74} + {I75}').format('$')
    spreadsheet.select('I77').insert(ytd_interest_exp).format('$')
    spreadsheet.select('I78').calc('{I76} + {I77}').format('$')
    spreadsheet.select('I79').calc('-(Math.max({I78} * {F79}, 0))').format('$')
    spreadsheet.select('I80').calc('{I78} + {I79}').format('$')
    spreadsheet.select('I82').insert(lastest_nwc).format('$')
    spreadsheet.select('I83').calc('{I82} / {H74}').format('%')


    // rest of year
    spreadsheet.select('J74:J80').calc('{L} - {I}').format('$')

    // five year projections
    spreadsheet.select('L74:P74').calc('{27}').format('$')
    spreadsheet.select('L75:P75').calc('{30} + {35}')
    spreadsheet.select('L76:P76').calc('{74} + {75}')
    spreadsheet.select('L77:P77').calc('-{F77} * {F75}')
    spreadsheet.select('L78:P78').calc('{76} + {77}')    
    spreadsheet.select('L79:P79').calc('-(Math.max({78} * {F79}, 0))')
    spreadsheet.select('L80:P80').calc('{78} + {79}')
    spreadsheet.select('L82:P82').calc('{83} * {74}')
    spreadsheet.select('L83:P83').insert(proj_nwc).format('%').editable()

    // depreciation schedule
    spreadsheet.select('H86:H87').insert(hist_ltm_da)
    spreadsheet.select('I86:I87').insert(hist_ytd_da)
    spreadsheet.select('I89').insert(lastest_ppe)
    
    spreadsheet.select('L86').calc('-{F86} * {I89}')
    spreadsheet.select('M86').calc('-{F86} * {L89}')
    spreadsheet.select('N86').calc('-{F86} * {M89}')
    spreadsheet.select('O86').calc('-{F86} * {N89}')
    spreadsheet.select('P86').calc('-{F86} * {O89}')

    spreadsheet.select('J86:J87').calc('{L} - {I}')

    spreadsheet.select('L87').insert(hist_ltm_da[1])
    spreadsheet.select('M87:P87').calc('{H87}')

    spreadsheet.select('L89').calc('{L86} + {L46} + {I89}')
    spreadsheet.select('M89').calc('{M86} + {M46} + {L89}')
    spreadsheet.select('N89').calc('{N86} + {N46} + {M89}')
    spreadsheet.select('O89').calc('{O86} + {O46} + {N89}')
    spreadsheet.select('P89').calc('{P86} + {P46} + {O89}')


    // NOL
    spreadsheet.select('J96').insert([0])
    // - begining balances
    spreadsheet.select('L93').calc('{J96}')
    spreadsheet.select('M93').calc('{L96}')
    spreadsheet.select('N93').calc('{M96}')
    spreadsheet.select('O93').calc('{N96}')
    spreadsheet.select('P93').calc('{O96}')

    // // - additions balances
    // spreadsheet.select('J94').calc('0')
    // spreadsheet.select('L94').calc('0')
    // spreadsheet.select('M94').calc('0')
    // spreadsheet.select('N94').calc('0')
    // spreadsheet.select('O94').calc('0')

    // // - usaage balances
    // spreadsheet.select('J95').calc('0')
    // spreadsheet.select('L95').calc('0')
    // spreadsheet.select('M95').calc('0')
    // spreadsheet.select('N95').calc('0')
    // spreadsheet.select('O95').calc('0')

    // - ending balances
    spreadsheet.select('J96').calc('{J93} + {J94} + {J95}')
    spreadsheet.select('L96').calc('{L93} + {L94} + {L95}')
    spreadsheet.select('M96').calc('{M93} + {M94} + {M95}')
    spreadsheet.select('N96').calc('{N93} + {N94} + {N95}')
    spreadsheet.select('O96').calc('{O93} + {O94} + {O95}')


    // headers
    // merged rows
      // text date format entered
    spreadsheet.select('H99:J99').insert([hist_text_dates[7], hist_text_dates[7], 'Rest of'])
    spreadsheet.select('L99:P99').insert(proj_text_dates)

      // text period format entered
    spreadsheet.select('H100:J100').insert([hist_period_text_dates[8], hist_period_text_dates[7], proj_period_text_dates[0]])
    spreadsheet.select('L100:P100').insert(proj_period_text_dates)

    spreadsheet.select('H101:I101').calc('{76}')
    spreadsheet.select('H102:I102').calc('-{101} * {F79}')
    spreadsheet.select('H103:I103').calc('{101} + {102}')
    spreadsheet.select('H104').calc('{J41}')
    spreadsheet.select('I104').calc('{I41}')
    spreadsheet.select('H105').insert(change_in_ltm_nwc)
    spreadsheet.select('I105').insert(change_in_ytd_nwc)
    spreadsheet.select('H106').calc('-{J46}')
    spreadsheet.select('I106').calc('-{H46}')
    spreadsheet.select('J101:J107').calc('{L} - {I}')
    spreadsheet.select('L101:P101').calc('{76}')
    spreadsheet.select('L102:P102').calc('-{101} * {F79}')
    spreadsheet.select('L103:P103').calc('{101} + {102}')
    spreadsheet.select('L104:P104').calc('-({86} + {87})')
    spreadsheet.select('L105').calc('-({L82} - fiscal_year_end_nwc)')
    spreadsheet.select('M105').calc('-({M82} - {L82})')
    spreadsheet.select('N105').calc('-({N82} - {M82})')
    spreadsheet.select('O105').calc('-({O82} - {N82})')
    spreadsheet.select('P105').calc('-({P82} - {O82})')
    spreadsheet.select('L106:P106').calc('-{46}')

    spreadsheet.select('Q101').calc('{P43} - {Q104}')
    spreadsheet.select('Q102').calc('-Math.max({Q101} * {F79}, 0)')
    spreadsheet.select('Q103').calc('{Q101} + {Q102}')
    spreadsheet.select('Q104').calc('-{Q106}*.9')
    spreadsheet.select('Q105').calc('-{P74}*{P83}+{P74}/(1+{M57})*{P83}')
    spreadsheet.select('Q106').calc('-{P74}*{P47}')

    spreadsheet.select('L107:Q107').calc('{103} + {104} + {105} + {106}')


    spreadsheet.select('H107:I107').calc('{103} + {104} + {105} + {106}')

    // DCF Periods
    spreadsheet.select('L110').calc('(({L5} + {J5})/2 - valuation_date)/365')
    spreadsheet.select('M110').calc('(({M5} + {L5})/2 - valuation_date)/365')
    spreadsheet.select('N110').calc('(({N5} + {M5})/2 - valuation_date)/365')
    spreadsheet.select('O110').calc('(({O5} + {N5})/2 - valuation_date)/365')
    spreadsheet.select('P110').calc('(({P5} + {O5})/2 - valuation_date)/365')

    // Discount Factors
    spreadsheet.select('L111').calc('1 / Math.pow((1 + {J58}),{L110})').format('%')
    spreadsheet.select('M111').calc('1 / Math.pow((1 + {J58}),{M110})').format('%')
    spreadsheet.select('N111').calc('1 / Math.pow((1 + {J58}),{N110})').format('%')
    spreadsheet.select('O111').calc('1 / Math.pow((1 + {J58}),{O110})').format('%')
    spreadsheet.select('P111').calc('1 / Math.pow((1 + {J58}),{P110})').format('%')

    spreadsheet.select('P112').calc('1 / Math.pow((1 + {J58}),(({P5}-{J5})/365))').format('%')

    // Fair value per share reconciliation
    spreadsheet.select('J116:N116').merge().insert(['Exit Method']).addClass('col_merge')
    spreadsheet.select('J117:N117').insert(['EBITDA Multiple', '', 'Revenue Multiple', 'Terminal Growth Rate', 'P/E Multiple']).addClass('col_merge')
    
    // EBITDA Exit
    spreadsheet.select('J118').calc('{J107} * {L111} + {M107} * {M111} + {N107} * {N111} + {O107} * {O111} + {P107} * {P111}')
    spreadsheet.select('J119').calc('{J57}*{P43}*{P112}')
    spreadsheet.select('J120').calc('{J118} + {J119}')
    spreadsheet.select('J121:J126').insert(equity_waterfall)
    spreadsheet.select('J127').calc('Math.max({J120} + {J121} + {J122} + {J123} + {J124} + {J125} + {J126}, 0)')
    spreadsheet.select('J128').insert(shares_outstanding)
    spreadsheet.select('J129').calc('{J127} / {J128}')


    // Revenue Exit
    spreadsheet.select('L118').calc('{J107} * {L111} + {M107} * {M111} + {N107} * {N111} + {O107} * {O111} + {P107} * {P111}')
    spreadsheet.select('L119').calc('{L57}*{P27}*{P112}')
    spreadsheet.select('L120').calc('{L118} + {L119}')
    spreadsheet.select('L121:L126').insert(equity_waterfall)
    spreadsheet.select('L127').calc('Math.max({L120} + {L121} + {L122} + {L123} + {L124} + {L125} + {L126}, 0)')
    spreadsheet.select('L128').insert(shares_outstanding)
    spreadsheet.select('L129').calc('{L127} / {L128}')


    // Terminal Growth Exit
    spreadsheet.select('M118').calc('{J107} * {L111} + {M107} * {M111} + {N107} * {N111} + {O107} * {O111} + {P107} * {P111}')
    spreadsheet.select('M119').calc('{Q107}*(1+{M57})/({M58}-{M57})*{P112}+{P96}*{F79}*.2')
    spreadsheet.select('M120').calc('{M118} + {M119}')
    spreadsheet.select('M121:M126').insert(equity_waterfall)
    spreadsheet.select('M127').calc('Math.max({M120} + {M121} + {M122} + {M123} + {M124} + {M125} + {M126}, 0)')
    spreadsheet.select('M128').insert(shares_outstanding)
    spreadsheet.select('M129').calc('{M127} / {M128}')


    // PE Exit
    spreadsheet.select('N118').calc('{J107} * {L111} + {M107} * {M111} + {N107} * {N111} + {O107} * {O111} + {P107} * {P111}')
    spreadsheet.select('N119').calc('{N120}-{N118}')
    spreadsheet.select('N120').calc('{N127} - {N121} - {N122} - {N123} - {N124} - {N125} - {N126}')
    spreadsheet.select('N121:N126').insert(equity_waterfall)
    spreadsheet.select('N127').calc('{N129} * {N128}')
    spreadsheet.select('N128').insert(shares_outstanding)
    spreadsheet.select('N129').calc('Math.max({P80}/{N128}*{N57}*{P112}, 0)')




    // hide historical annual and quarterly data
    // spreadsheet.select(':B, :C, :D, :E, :H, :I').hide()

    // hide projected annual data
    // spreadsheet.select(':L, :M, :N, :O, :P').hide()


    // spreadsheet.select('1:3').hide()
    // spreadsheet.select('10:26').hide()
    spreadsheet.select('G').width(10)
    spreadsheet.select('K').width(10)

    // spreadsheet.select('{30}, {31}, {32}, {33}, {34}, {35}, {36}, {37}').height(1)



    function years(arr) {
      return arr.map(function(item) {
        return 'Year ' + item;
      })
    }

  </script>
</body>
</html>
