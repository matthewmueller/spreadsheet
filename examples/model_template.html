<!doctype html>
<html>
<head>
  <title>spreadsheet component</title>
  <link rel="stylesheet" href="../build/build.css">
  <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1">
  <style>
    .spreadsheet {
      margin: 0 auto;
      max-width: 1100px;
    }
    table {
      /*border-collapse: collapse;*/
      font-size: 7.5pt;
      text-align: right;

    }

    table .headers {
      text-align: left;
    }


    table td {
      /*border: 1px solid #ccc;*/
      padding: 5px;
    }

    table th {
      max-width: 60px;
    }

    .header {
      font-weight: normal;
      font-style: italic;
      font-family: Arial;

    }

    .col_merge {
      text-align: center;
      font-weight: bold;
      border-bottom: solid black 1px !important;
    }

    .rating {
      text-align: center;
      font-weight: bold;
      color: green !important;
    }

    .totals {
      font-weight: bold;
    }

    .whiteout {
      color: white !important;
    }

    .spacer {
      height: 1px !important;
    }

    .input_heading {
      background-color: #f2f2f2;
      font-weight: bold;
      text-align: center;
    }

    .titles {
      font-weight: bold;
      text-align: center;
    }

    .total_border {
      border-top: solid black 1px !important;
      border-bottom: solid black 1px !important;
    }


  </style>
</head>
<body>
  <h1 style="font-family:verdana; font-size:10pt">LR Model Template</h1>
  <script src="../build/build.js" type="text/javascript"></script>
  <script type="text/javascript">

    // ***********************************************************
    // Input Assumptions
    // ***********************************************************

    //Paste
        // inputs
    var company_name = "The Wendy's Company";
    var valuation_date = 41788;

    var trading_price = 9.35;

    var EBITDA_exit = 12.2;
    var rev_exit = 1.88;
    var growth_exit = 0.035;
    var pe_exit = 39.97;

    var discount_rate = 0.11;
    var equity_discount_rate = 0.13;

    // balance sheet inputs
    var debt = 1461.57;
    var interest_rate = 0.04;
    var tax_rate = 0.35;
    var dep_prior_ppe = 0.109;
    var lastest_nwc = -61.373;
    var fiscal_year_end_nwc = -88.93;

    var equity_waterfall = [-79.909, 0, -2.031375, 0, 1461.57, -384.695];
    var shares_outstanding = 377.248128502674;

    var change_in_ltm_nwc = -14.126;
    var change_in_ytd_nwc = -27.557;

    var lastest_ppe = 1146.996;


    // enter excel dates
    // [LTM, FY+1, FY+2, FY+3, FY+4, FY+5]
    var ltm_num_dates = 41701;
    var proj_num_dates = [42004, 42369, 42735, 43100, 43465];


    // enter text dates
    var hist_text_dates = ['Dec-09', 'Dec-10', 'Dec-11', 'Dec-12', 'Dec-13', '', 'Mar-13', 'Mar-14', 'Mar-14'];
    var proj_text_dates = ['Dec-14', 'Dec-15', 'Dec-16', 'Dec-17', 'Dec-18'];


    // enter text periods
    var hist_period_text_dates = ['FY 09', 'FY 10', 'FY 11', 'FY 12', 'FY 13', '', 'YTD Prior', 'YTD', 'LTM'];
    var proj_period_text_dates = ['FY 14', 'FY 15', 'FY 16', 'FY 17', 'FY 18'];


    // income statement inputs
    var rev_title_1 = "     Franchise Revenues";
    var rev_title_2 = "     Sales";
    var rev_title_3 = "   Segment 3";
    var rev_title_4 = "   Segment 4";
    var rev_title_5 = "   Segment 5";
    var rev_title_6 = "   Segment 6";
    var rev_title_7 = "   Segment 7";


    // historical revenue growth by segment
      // [FY-4, FY-3, FY-2, FY-1, FY, YTD Prior Prior, YTD Prior, YTD]
    var hist_rev_fin_1 = [302.853, 296.358, 304.814, 306.919, 321.581, 73.258, 73.009, 90.566];
    var hist_rev_fin_2 = [2134.242, 2079.081, 2126.544, 2198.323, 2165.829, 519.929, 530.673, 432.63];
    var hist_rev_fin_3 = [0, 0, 0, 0, 0, 0, 0, 0];
    var hist_rev_fin_4 = [0, 0, 0, 0, 0, 0, 0, 0];
    var hist_rev_fin_5 = [0, 0, 0, 0, 0, 0, 0, 0];
    var hist_rev_fin_6 = [0, 0, 0, 0, 0, 0, 0, 0];
    var hist_rev_fin_7 = [0, 0, 0, 0, 0, 0, 0, 0];


    // historical cogs, sg&a, d&a, and capex
    var hist_cogs_fin = [-1812.056, -1756.954, -1815.328, -1880.463, -1825.507, '', -460.64475, -374.00675];
    var hist_sga_fin = [-487.211, -438.357, -415.079, -434.364, -475.976, '', -117.06325, -112.34325];
    var hist_da_fin = [134.063, 126.846, 122.992, 146.976, 182.359, '', 51.797, 42.021];


    // ytd [dep, amort]
    var hist_ltm_da = [-133.974, -38.609];
    var hist_ytd_da = [-32.36875, -9.65225];
    var hist_capex_fin = [101.914, 147.969, 146.763, 197.59, 224.245, '', 39.977, 53.058];


    // all segments
    var ytd_prior_rev_growth = [-0.0034, 0.0207, 0, 0, 0, 0, 0, 0.0177];
    var ltm_rev_growth = [0.1059, -0.064, 0, 0, 0, 0, 0, -0.0433];


    // interest expense
    var ltm_interest_exp = -61.042;
    var ytd_interest_exp = -12.994;

      // projected inputs
      var proj_rev_growth_1 = [0.106, 0.106, 0.106, 0.106, 0.106];
      var proj_rev_growth_2 = [-0.063, -0.063, -0.063, -0.063, -0.063];
      var proj_rev_growth_3 = [0, 0, 0, 0, 0];
      var proj_rev_growth_4 = [0, 0, 0, 0, 0];
      var proj_rev_growth_5 = [0, 0, 0, 0, 0];
      var proj_rev_growth_6 = [0, 0, 0, 0, 0];
      var proj_rev_growth_7 = [0, 0, 0, 0, 0];

      var proj_seg_rev_growth = [proj_rev_growth_1, proj_rev_growth_2, proj_rev_growth_3, proj_rev_growth_4, proj_rev_growth_5, proj_rev_growth_6, proj_rev_growth_7];

      var proj_total_rev_growth = [-0.041, -0.038, -0.034, -0.03, -0.025];
      var proj_gp_margin = [0.277, 0.277, 0.277, 0.277, 0.277];
      var proj_sga_margin = [0.196, 0.196, 0.196, 0.196, 0.196];
      var proj_ebit_margin = [0.082, 0.082, 0.082, 0.082, 0.082];
      var proj_capex_margin = [0.098, 0.098, 0.098, 0.098, 0.098];
      var proj_nwc = [-0.03, -0.03, -0.03, -0.03, -0.03];


    // ***********************************************************
    // Start Assumption Collection
    // ***********************************************************

    var Spreadsheet = require('spreadsheet');
    var spreadsheet = Spreadsheet('Q137');
    document.body.appendChild(spreadsheet.el);

    // column titles
    spreadsheet.select('A').width(150)
    spreadsheet.select('A1:A65').addClass('headers')
      .insert(['', 
               '', 
               '', 
               '', 
               '', 
               '',
               company_name + ' Model',
              '',
              'Growth Assumptions:',
              rev_title_1 + ' Growth',
              rev_title_2 + ' Growth',
              rev_title_3 + ' Growth',
              rev_title_4 + ' Growth',
              rev_title_5 + ' Growth',
              rev_title_6 + ' Growth',
              rev_title_7 + ' Growth',
              'Total Revenue Growth',
              '',
              'Implied Forecast:',
              '  '+rev_title_1,
              '  '+rev_title_2,                                
              '  '+rev_title_3,
              '  '+rev_title_4,
              '  '+rev_title_5,
              '  '+rev_title_6,
              '  '+rev_title_7,
              'Total Revenue',
              '  Growth',
              '',
              'Cost of Goods',
              '',
              'Gross Profit',
              '  GP Margin',
              '',
              'SG&A Expenses',
              '  % of Revenue',
              '',
              'EBIT',
              '  EBIT Margin',
              '',
              '(+) D&A',
              '',
              'EBITDA',
              '  EBITDA Margin',
              '',
              'Capital Expenditures',
              '  % of Revenue',
              '',
              'Stock Price Analysis',
              '',
              'Valuation Date',
              '',
              '5-Year Exit Method',
              '',
              'Use Method (Y to Use, N to Ignore)',
              '',
              'Exit in Year 5 at',
              'Assumed Discount Rate',
              'Implied Fair Value per Share',
              'Current Trading Price',
              '',
              ' Discount/(Premium) to Current Price',
              '',
              'Your Rating',
              ''])

    spreadsheet.select('A1:P1').insert(['A', 'B', 'C', 'D', 'E', 'F', 'G', 'H', 'I',
                                        'J', 'K', 'L', 'M', 'N', 'O', 'P'])

    // merged rows
    spreadsheet.select('L4:P4').merge().insert(['Projections']).addClass('col_merge')

    // historical date titles
      // excel number of days entered
    spreadsheet.select('J5').insert(ltm_num_dates)
    spreadsheet.select('L5:P5').insert(proj_num_dates)

      // text date format entered
    spreadsheet.select('B6:J6').insert(hist_text_dates)
    spreadsheet.select('L6:P6').insert(proj_text_dates)

      // text period format entered
    spreadsheet.select('B7:J7').insert(hist_period_text_dates)
    spreadsheet.select('L7:P7').insert(proj_period_text_dates)

    // revenue input historical
    spreadsheet.select('B20:I20').insert(hist_rev_fin_1).format('$')
    spreadsheet.select('B21:I21').insert(hist_rev_fin_2).format('#')
    spreadsheet.select('B22:I22').insert(hist_rev_fin_3).format('#')
    spreadsheet.select('B23:I23').insert(hist_rev_fin_4).format('#')
    spreadsheet.select('B24:I24').insert(hist_rev_fin_5).format('#')
    spreadsheet.select('B25:I25').insert(hist_rev_fin_6).format('#')
    spreadsheet.select('B26:I26').insert(hist_rev_fin_7).format('#')
    spreadsheet.select('J20').calc('{I} + {F} - {H}').format('$')
    spreadsheet.select('J21:J26').calc('{I} + {F} - {H}').format('#')
    
    // revenue totals sum historical
    spreadsheet.select('B27:J27').calc('{20} + {21} + {22} + {23} + {24} + {25} + {26}').format('$')

    // segment and total growth calculate historical
    spreadsheet.select('C10').calc('{C20} / {B20} - 1').format('%')
    spreadsheet.select('C11').calc('{C21} / {B21} - 1').format('%')
    spreadsheet.select('C12').calc('{C22} / {B22} - 1').format('%')
    spreadsheet.select('C13').calc('{C23} / {B23} - 1').format('%')
    spreadsheet.select('C14').calc('{C24} / {B24} - 1').format('%')
    spreadsheet.select('C15').calc('{C25} / {B25} - 1').format('%')
    spreadsheet.select('C16').calc('{C26} / {B26} - 1').format('%')
    spreadsheet.select('C17').calc('{C27} / {B27} - 1').format('%')

    spreadsheet.select('D10').calc('{D20} / {C20} - 1').format('%')
    spreadsheet.select('D11').calc('{D21} / {C21} - 1').format('%')
    spreadsheet.select('D12').calc('{D22} / {C22} - 1').format('%')
    spreadsheet.select('D13').calc('{D23} / {C23} - 1').format('%')
    spreadsheet.select('D14').calc('{D24} / {C24} - 1').format('%')
    spreadsheet.select('D15').calc('{D25} / {C25} - 1').format('%')
    spreadsheet.select('D16').calc('{D26} / {C26} - 1').format('%')
    spreadsheet.select('D17').calc('{D27} / {C27} - 1').format('%')

    spreadsheet.select('E10').calc('{E20} / {D20} - 1').format('%')
    spreadsheet.select('E11').calc('{E21} / {D21} - 1').format('%')
    spreadsheet.select('E12').calc('{E22} / {D22} - 1').format('%')
    spreadsheet.select('E13').calc('{E23} / {D23} - 1').format('%')
    spreadsheet.select('E14').calc('{E24} / {D24} - 1').format('%')
    spreadsheet.select('E15').calc('{E25} / {D25} - 1').format('%')
    spreadsheet.select('E16').calc('{E26} / {D26} - 1').format('%')
    spreadsheet.select('E17').calc('{E27} / {D27} - 1').format('%')

    spreadsheet.select('F10').calc('{F20} / {E20} - 1').format('%')
    spreadsheet.select('F11').calc('{F21} / {E21} - 1').format('%')
    spreadsheet.select('F12').calc('{F22} / {E22} - 1').format('%')
    spreadsheet.select('F13').calc('{F23} / {E23} - 1').format('%')
    spreadsheet.select('F14').calc('{F24} / {E24} - 1').format('%')
    spreadsheet.select('F15').calc('{F25} / {E25} - 1').format('%')
    spreadsheet.select('F16').calc('{F26} / {E26} - 1').format('%')
    spreadsheet.select('F17').calc('{F27} / {E27} - 1').format('%')

    spreadsheet.select('H10:H17').insert(ytd_prior_rev_growth).format('%')
    spreadsheet.select('H28').insert(ytd_prior_rev_growth[ytd_prior_rev_growth.length-1]).format('%')

    spreadsheet.select('I10').calc('{I20} / {H20} - 1').format('%')
    spreadsheet.select('I11').calc('{I21} / {H21} - 1').format('%')
    spreadsheet.select('I12').calc('{I22} / {H22} - 1').format('%')
    spreadsheet.select('I13').calc('{I23} / {H23} - 1').format('%')
    spreadsheet.select('I14').calc('{I24} / {H24} - 1').format('%')
    spreadsheet.select('I15').calc('{I25} / {H25} - 1').format('%')
    spreadsheet.select('I16').calc('{I26} / {H26} - 1').format('%')
    spreadsheet.select('I17').calc('{I27} / {H27} - 1').format('%')

    spreadsheet.select('J10:J17').insert(ltm_rev_growth).format('%')

    // total revenue growth rates below
    spreadsheet.select('C28').calc('{C27} / {B27} - 1').format('%')
    spreadsheet.select('D28').calc('{D27} / {C27} - 1').format('%')
    spreadsheet.select('E28').calc('{E27} / {D27} - 1').format('%')
    spreadsheet.select('F28').calc('{F27} / {E27} - 1').format('%')
    spreadsheet.select('I28').calc('{I27} / {H27} - 1').format('%')
    spreadsheet.select('J28').insert(ltm_rev_growth[ltm_rev_growth.length-1]).format('%')

    //// projected revenue inputs
      spreadsheet.select('L10:P10').insert(proj_seg_rev_growth[0]).editable().format('%')
      spreadsheet.select('L11:P11').insert(proj_seg_rev_growth[1]).editable().format('%')
      spreadsheet.select('L12:P12').insert(proj_seg_rev_growth[2]).editable().format('%')
      spreadsheet.select('L13:P13').insert(proj_seg_rev_growth[3]).editable().format('%')
      spreadsheet.select('L14:P14').insert(proj_seg_rev_growth[4]).editable().format('%')
      spreadsheet.select('L15:P15').insert(proj_seg_rev_growth[5]).editable().format('%')
      spreadsheet.select('L16:P16').insert(proj_seg_rev_growth[6]).editable().format('%')
      spreadsheet.select('L17:P17').calc('{28}').format('%')

      spreadsheet.select('L20').calc('({L10}+1) * {F20}').format('$')
      spreadsheet.select('M20').calc('({M10}+1) * {L20}').format('$')
      spreadsheet.select('N20').calc('({N10}+1) * {M20}').format('$')
      spreadsheet.select('O20').calc('({O10}+1) * {N20}').format('$')
      spreadsheet.select('P20').calc('({P10}+1) * {O20}').format('$')

      spreadsheet.select('L21').calc('({L11}+1) * {F21}').format('#')
      spreadsheet.select('M21').calc('({M11}+1) * {L21}').format('#')
      spreadsheet.select('N21').calc('({N11}+1) * {M21}').format('#')
      spreadsheet.select('O21').calc('({O11}+1) * {N21}').format('#')
      spreadsheet.select('P21').calc('({P11}+1) * {O21}').format('#')

      spreadsheet.select('L22').calc('({L12}+1) * {F22}').format('#')
      spreadsheet.select('M22').calc('({M12}+1) * {L22}').format('#')
      spreadsheet.select('N22').calc('({N12}+1) * {M22}').format('#')
      spreadsheet.select('O22').calc('({O12}+1) * {N22}').format('#')
      spreadsheet.select('P22').calc('({P12}+1) * {O22}').format('#')

      spreadsheet.select('L23').calc('({L13}+1) * {F23}').format('#')
      spreadsheet.select('M23').calc('({M13}+1) * {L23}').format('#')
      spreadsheet.select('N23').calc('({N13}+1) * {M23}').format('#')
      spreadsheet.select('O23').calc('({O13}+1) * {N23}').format('#')
      spreadsheet.select('P23').calc('({P13}+1) * {O23}').format('#')

      spreadsheet.select('L24').calc('({L14}+1) * {F24}').format('#')
      spreadsheet.select('M24').calc('({M14}+1) * {L24}').format('#')
      spreadsheet.select('N24').calc('({N14}+1) * {M24}').format('#')
      spreadsheet.select('O24').calc('({O14}+1) * {N24}').format('#')
      spreadsheet.select('P24').calc('({P14}+1) * {O24}').format('#')

      spreadsheet.select('L25').calc('({L15}+1) * {F25}').format('#')
      spreadsheet.select('M25').calc('({M15}+1) * {L25}').format('#')
      spreadsheet.select('N25').calc('({N15}+1) * {M25}').format('#')
      spreadsheet.select('O25').calc('({O15}+1) * {N25}').format('#')
      spreadsheet.select('P25').calc('({P15}+1) * {O25}').format('#')

      spreadsheet.select('L26').calc('({L16}+1) * {F26}').format('#')
      spreadsheet.select('M26').calc('({M16}+1) * {L26}').format('#')
      spreadsheet.select('N26').calc('({N16}+1) * {M26}').format('#')
      spreadsheet.select('O26').calc('({O16}+1) * {N26}').format('#')
      spreadsheet.select('P26').calc('({P16}+1) * {O26}').format('#')

      spreadsheet.select('L28:P28').insert(proj_total_rev_growth).editable().format('%')

      spreadsheet.select('L27').calc('({L28}+1) * {F27}').format('$')
      spreadsheet.select('M27').calc('({M28}+1) * {L27}').format('$')
      spreadsheet.select('N27').calc('({N28}+1) * {M27}').format('$')
      spreadsheet.select('O27').calc('({O28}+1) * {N27}').format('$')
      spreadsheet.select('P27').calc('({P28}+1) * {O27}').format('$')

    // cogs
    spreadsheet.select('B30:I30').insert(hist_cogs_fin).format('#')
    spreadsheet.select('J30').calc('{F} + {I} - {H}').format('#')

    //// projected cogs
    spreadsheet.select('L30:P30').calc('{32} - {27}').format('#')

    // gp
    spreadsheet.select('B32:F32').calc('{27} + {30}').format('#')
    spreadsheet.select('H32:J32').calc('{27} + {30}').format('#')
    spreadsheet.select('B33:F33').calc('{32} / {27}').format('%')
    spreadsheet.select('H33:J33').calc('{32} / {27}').format('%')

    //// projected gp inputs
      spreadsheet.select('L33:P33').insert(proj_gp_margin).editable().format('%')
      spreadsheet.select('L32').calc('{L27} * {L33}').format('#')
      spreadsheet.select('M32').calc('{M27} * {M33}').format('#')
      spreadsheet.select('N32').calc('{N27} * {N33}').format('#')
      spreadsheet.select('O32').calc('{O27} * {O33}').format('#')
      spreadsheet.select('P32').calc('{P27} * {P33}').format('#')


    // sga
    spreadsheet.select('B35:I35').insert(hist_sga_fin).format('#')
    spreadsheet.select('J35').calc('{F} + {I} - {H}').format('#')
    spreadsheet.select('B36:F36').calc('-{35} / {27}').format('%')
    spreadsheet.select('H36:J36').calc('-{35} / {27}').format('%')

    //// projected sga inputs
      spreadsheet.select('L36:P36').insert(proj_sga_margin).editable().format('%')
      spreadsheet.select('L35').calc('-{L27} * {L36}').format('#')
      spreadsheet.select('M35').calc('-{M27} * {M36}').format('#')
      spreadsheet.select('N35').calc('-{N27} * {N36}').format('#')
      spreadsheet.select('O35').calc('-{O27} * {O36}').format('#')
      spreadsheet.select('P35').calc('-{P27} * {P36}').format('#')

    // ebit
    spreadsheet.select('B38:F38').calc('{32} + {35}').format('$')
    spreadsheet.select('H38:J38').calc('{32} + {35}').format('$')
    spreadsheet.select('B39:F39').calc('{38} / {27}').format('%')
    spreadsheet.select('H39:J39').calc('{38} / {27}').format('%')

    //// projected ebit inputs
      spreadsheet.select('L39:P39').insert(proj_ebit_margin).editable().format('%')
      spreadsheet.select('L38').calc('{L27} * {L39}').format('$')
      spreadsheet.select('M38').calc('{M27} * {M39}').format('$')
      spreadsheet.select('N38').calc('{N27} * {N39}').format('$')
      spreadsheet.select('O38').calc('{O27} * {O39}').format('$')
      spreadsheet.select('P38').calc('{P27} * {P39}').format('$')

    // d&a
    spreadsheet.select('B41:I41').insert(hist_da_fin).format('#')
    spreadsheet.select('J41').calc('{F} + {I} - {H}').format('#')

    //// projected d&a
      spreadsheet.select('L41:P41').calc('{104}').format('#')

    // ebitda
    spreadsheet.select('B43:F43').calc('{38} + {41}').format('$')
    spreadsheet.select('H43:J43').calc('{38} + {41}').format('$')
    spreadsheet.select('B44:F44').calc('{43} / {27}').format('%')
    spreadsheet.select('H44:J44').calc('{43} / {27}').format('%')

    //// projected ebitda calc
    spreadsheet.select('L43:P43').calc('{41} + {38}').format('$')
    spreadsheet.select('L44:P44').calc('{43} / {27}').format('%')

    // capex
    spreadsheet.select('B46:I46').insert(hist_capex_fin).format('#')
    spreadsheet.select('J46').calc('{F} + {I} - {H}').format('#')

    spreadsheet.select('B47:F47').calc('{46} / {27}').format('%')
    spreadsheet.select('H47:J47').calc('{46} / {27}').format('%')

    //// projected capex inputs
      spreadsheet.select('L47:P47').insert(proj_capex_margin).editable().format('%')
      spreadsheet.select('L46').calc('{L27} * {L47}').format('#')
      spreadsheet.select('M46').calc('{M27} * {M47}').format('#')
      spreadsheet.select('N46').calc('{N27} * {N47}').format('#')
      spreadsheet.select('O46').calc('{O27} * {O47}').format('#')
      spreadsheet.select('P46').calc('{P27} * {P47}').format('#')

// ***************************************************************
// Calculation Details and Methodology
// ***************************************************************

  // financial statement assumptions
    spreadsheet.select('A66:A136').addClass('headers')
      .insert(['',
               '',
               'Calculation Details and Methodology',
               'Financial Statement Assumptions',
               '',
               '',
               'Implied Forecast',
               '',
               'Total Revenue',
               'COGS + SG&A Expenses',
               'EBIT',
               'Interest Expense',
               'EBT',
               'Pro forma Tax Expense',
               'Adjusted Net Income',
               '',
               'Net Working Capital',
               '% of Revenue',
               '',
               'Depreciation Schedule',
               'Depreciation',
               'Amortization',
               '',
               'PP&E',
               '',
               '',
               'NOL Schedule:',
               'NOL Beginning Balance',
               '  (+) Additions',
               '  (-) Usage',
               'NOL Ending Balance',
               '',
               'Discounted Cash Flow Analysis',
               '',
               'Implied Forecast',
               'EBIT',
               '  (-) Pro forma Tax Expense',
               'NOPAT',
               '  (+) Depreciation and Amortization',
               '  (-) Investment in Working Capital',
               '  (-) Capital Expenditures',
               'Unlevered Free Cash Flow',
               '',
               'DCF Periods',
               'Discount Factor (Middle of Period)',
               'Discount Factor (End of Period)',
               'Discount Factor - Cost of Equity',
               '',
               'Fair Value per Share Reconcilation',
               '',
               '',
               '',
               'Present Value of Discrete Cash Flow',
               'Present Value of Terminal Cash Flow',
               'Enterprise Value',
               '  (+) Unconsolidated Investments',
               '  (+) Deferred Revenue Adj',
               '  (+/-) Other',
               '  (-) Non-controlling Interests',
               '  (-) Debt',
               '  (+) Cash',
               'Equity Value',
               '  (x) Diluted Shares Outstanding (Mil)',
               'Estimated Fair Value per Share',
               '',
               '',
               'NOL Based on DCF',
               'NOL Beginning Balance',
               '(+) Additions',
               '(-) Usage',
               'NOL Ending Balance'])
    
    spreadsheet.select('J51').insert(valuation_date)
    spreadsheet.select('J53').insert('EBITDA Multiple')
    spreadsheet.select('L53').insert('Revenue Multiple')
    spreadsheet.select('M53').insert('Terminal Growth Rate')
    spreadsheet.select('N53').insert('P/E Multiple')

    spreadsheet.select('J55:N55').insert(['Y', '', 'Y', 'Y', 'Y'])
    spreadsheet.select('J57').insert([EBITDA_exit]).editable()
    spreadsheet.select('L57').insert([rev_exit]).editable()
    spreadsheet.select('M57').insert([growth_exit]).format('%').editable()
    spreadsheet.select('N57').insert([pe_exit]).editable()

    spreadsheet.select('J58').insert(discount_rate).editable().format('%')
    spreadsheet.select('L58:M58').calc('{J58}').format('%')
    spreadsheet.select('N58').insert(equity_discount_rate).editable().format('%')


    spreadsheet.select('J59').calc('{J129}').format('$')
    spreadsheet.select('L59:N59').calc('{129}').format('#')

    spreadsheet.select('J60').insert([trading_price]).format('#')
    spreadsheet.select('L60:N60').calc('{J60}').format('#')

    spreadsheet.select('J62').calc('{J59} / {J60} - 1').format('%')
    spreadsheet.select('L62:N62').calc('{59} / {60} - 1').format('%')

    spreadsheet.select('J64:L64').merge().insert('BUY').addClass('rating')

    // titles
    // merged rows
    spreadsheet.select('L70:P70').merge().insert(['Implied Projection']).addClass('col_merge')

      // text date format entered
    spreadsheet.select('H71:J71').insert([hist_text_dates[7], hist_text_dates[7], 'Rest of'])
    spreadsheet.select('L71:P71').insert(proj_text_dates)

      // text period format entered
    spreadsheet.select('H72:J72').insert([hist_period_text_dates[8], hist_period_text_dates[7], proj_period_text_dates[0]])
    spreadsheet.select('L72:P72').insert(proj_period_text_dates)

    // additional inputs
    spreadsheet.select('F74').insert('Current Debt')
    spreadsheet.select('F75').insert(debt).editable().format('$')

    spreadsheet.select('F76').insert('Interest Rate')
    spreadsheet.select('F77').insert(interest_rate).editable().format('%')

    spreadsheet.select('F78').insert('Tax Rate')
    spreadsheet.select('F79').insert(tax_rate).editable().format('%')

    spreadsheet.select('F85').insert('Dep % of Prior PP&E')
    spreadsheet.select('F86').insert(dep_prior_ppe).editable().format('%')

    // ltm column
    spreadsheet.select('H74').calc('{J27}').format('$')
    spreadsheet.select('H75').calc('{J30} + {J35}').format('#')
    spreadsheet.select('H76').calc('{H74} + {H75}').format('#')
    spreadsheet.select('H77').insert(ltm_interest_exp).format('#')
    spreadsheet.select('H78').calc('{H76} + {H77}').format('#')
    spreadsheet.select('H79').calc('-(Math.max({H78} * {F79}, 0))').format('#')
    spreadsheet.select('H80').calc('{H78} + {H79}').format('$')

    // ytd column
    spreadsheet.select('I74').calc('{I27}').format('$')
    spreadsheet.select('I75').calc('{I30} + {I35}').format('#')
    spreadsheet.select('I76').calc('{I74} + {I75}').format('#')
    spreadsheet.select('I77').insert(ytd_interest_exp).format('#')
    spreadsheet.select('I78').calc('{I76} + {I77}').format('#')
    spreadsheet.select('I79').calc('-(Math.max({I78} * {F79}, 0))').format('#')
    spreadsheet.select('I80').calc('{I78} + {I79}').format('$')
    spreadsheet.select('I82').insert(lastest_nwc).format('$')
    spreadsheet.select('I83').calc('{I82} / {H74}').format('%')


    // rest of year
    spreadsheet.select('J74').calc('{L} - {I}').format('$')
    spreadsheet.select('J75:J79').calc('{L} - {I}').format('#')
    spreadsheet.select('J80').calc('{L} - {I}').format('$')


    // five year projections
    spreadsheet.select('L74:P74').calc('{27}').format('$')
    spreadsheet.select('L75:P75').calc('{30} + {35}').format('#')
    spreadsheet.select('L76:P76').calc('{74} + {75}').format('#')
    spreadsheet.select('L77:P77').calc('-{F77} * {F75}').format('#')
    spreadsheet.select('L78:P78').calc('{76} + {77}').format('#')    
    spreadsheet.select('L79:P79').calc('-(Math.max({78} * {F79}, 0))').format('#')
    spreadsheet.select('L80:P80').calc('{78} + {79}').format('$')
    
    spreadsheet.select('L82:P82').calc('{83} * {74}').format('$')
    spreadsheet.select('L83:P83').insert(proj_nwc).format('%').editable()

    // depreciation schedule
    spreadsheet.select('H86:H87').insert(hist_ltm_da).format('#')
    spreadsheet.select('I86:I87').insert(hist_ytd_da).format('#')
    spreadsheet.select('I89').insert(lastest_ppe).format('$')
    
    spreadsheet.select('L86').calc('-{F86} * {I89}').format('#')
    spreadsheet.select('M86').calc('-{F86} * {L89}').format('#')
    spreadsheet.select('N86').calc('-{F86} * {M89}').format('#')
    spreadsheet.select('O86').calc('-{F86} * {N89}').format('#')
    spreadsheet.select('P86').calc('-{F86} * {O89}').format('#')

    spreadsheet.select('J86:J87').calc('{L} - {I}').format('#')

    spreadsheet.select('L87').insert(hist_ltm_da[1]).format('#')
    spreadsheet.select('M87:P87').calc('{H87}').format('#')

    spreadsheet.select('L89').calc('{L86} + {L46} + {I89}').format('$')
    spreadsheet.select('M89').calc('{M86} + {M46} + {L89}').format('$')
    spreadsheet.select('N89').calc('{N86} + {N46} + {M89}').format('$')
    spreadsheet.select('O89').calc('{O86} + {O46} + {N89}').format('$')
    spreadsheet.select('P89').calc('{P86} + {P46} + {O89}').format('$')


    // Actual NOL
    spreadsheet.select('J96').insert([0])
    // - begining balances
    spreadsheet.select('L93').calc('{J96}')
    spreadsheet.select('M93').calc('{L96}')
    spreadsheet.select('N93').calc('{M96}')
    spreadsheet.select('O93').calc('{N96}')
    spreadsheet.select('P93').calc('{O96}')

    // // - additions balances
    // spreadsheet.select('J94').calc('0')
    // spreadsheet.select('L94').calc('0')
    // spreadsheet.select('M94').calc('0')
    // spreadsheet.select('N94').calc('0')
    // spreadsheet.select('O94').calc('0')

    // // - usaage balances
    // spreadsheet.select('J95').calc('0')
    // spreadsheet.select('L95').calc('0')
    // spreadsheet.select('M95').calc('0')
    // spreadsheet.select('N95').calc('0')
    // spreadsheet.select('O95').calc('0')

    // - ending balances
    spreadsheet.select('J96').calc('{J93} + {J94} + {J95}')
    spreadsheet.select('L96').calc('{L93} + {L94} + {L95}')
    spreadsheet.select('M96').calc('{M93} + {M94} + {M95}')
    spreadsheet.select('N96').calc('{N93} + {N94} + {N95}')
    spreadsheet.select('O96').calc('{O93} + {O94} + {O95}')
    spreadsheet.select('P96').calc('{P93} + {P94} + {P95}')


    // titles
    // merged rows
      // text date format entered
    spreadsheet.select('H99:J99').insert([hist_text_dates[7], hist_text_dates[7], 'Rest of'])
    spreadsheet.select('L99:Q99').insert(proj_text_dates.concat(['Terminal']))

      // text period format entered
    spreadsheet.select('H100:J100').insert([hist_period_text_dates[8], hist_period_text_dates[7], proj_period_text_dates[0]])
    spreadsheet.select('L100:Q100').insert(proj_period_text_dates.concat(['Cash Flow']))

    spreadsheet.select('H101:I101').calc('{76}').format('$')
    spreadsheet.select('H102:I102').calc('-{101} * {F79}').format('#')
    spreadsheet.select('H103:I103').calc('{101} + {102}').format('$')
    spreadsheet.select('I104').calc('{I41}').format('#')
    spreadsheet.select('I105').insert(change_in_ytd_nwc).format('#')
    spreadsheet.select('I106').calc('-{H46}').format('#')
    spreadsheet.select('J101:J107').calc('{L} - {I}').format('#')
    spreadsheet.select('L101:P101').calc('{76}').format('$')
    spreadsheet.select('L102:P102').calc('-{101} * {F79}').format('#')
    spreadsheet.select('L103:P103').calc('{101} + {102}').format('$')
    spreadsheet.select('L104:P104').calc('-({86} + {87})').format('#')
    spreadsheet.select('L105').calc('-({L82} - fiscal_year_end_nwc)').format('#')
    spreadsheet.select('M105').calc('-({M82} - {L82})').format('#')
    spreadsheet.select('N105').calc('-({N82} - {M82})').format('#')
    spreadsheet.select('O105').calc('-({O82} - {N82})').format('#')
    spreadsheet.select('P105').calc('-({P82} - {O82})').format('#')
    spreadsheet.select('L106:P106').calc('-{46}').format('#')

    spreadsheet.select('Q101').calc('{P43} - {Q104}').format('$')
    spreadsheet.select('Q102').calc('-Math.max({Q101} * {F79}, 0)').format('#')
    spreadsheet.select('Q103').calc('{Q101} + {Q102}').format('$')
    spreadsheet.select('Q104').calc('-{Q106}*.9').format('#')
    spreadsheet.select('Q105').calc('-{P74}*{P83}+{P74}/(1+{M57})*{P83}').format('#')
    spreadsheet.select('Q106').calc('-{P74}*{P47}').format('#')

    spreadsheet.select('L107:Q107').calc('{103} + {104} + {105} + {106}').format('$')
    spreadsheet.select('I107').calc('{103} + {104} + {105} + {106}').format('$')

    // DCF Periods
    spreadsheet.select('L109').calc('(({L5} + {J5})/2 - valuation_date)/365').format('##')
    spreadsheet.select('M109').calc('(({M5} + {L5})/2 - valuation_date)/365').format('##')
    spreadsheet.select('N109').calc('(({N5} + {M5})/2 - valuation_date)/365').format('##')
    spreadsheet.select('O109').calc('(({O5} + {N5})/2 - valuation_date)/365').format('##')
    spreadsheet.select('P109').calc('(({P5} + {O5})/2 - valuation_date)/365').format('##')

    // Discount Factors
    spreadsheet.select('L110').calc('1 / Math.pow((1 + {J58}),{L109})').format('%')
    spreadsheet.select('M110').calc('1 / Math.pow((1 + {J58}),{M109})').format('%')
    spreadsheet.select('N110').calc('1 / Math.pow((1 + {J58}),{N109})').format('%')
    spreadsheet.select('O110').calc('1 / Math.pow((1 + {J58}),{O109})').format('%')
    spreadsheet.select('P110').calc('1 / Math.pow((1 + {J58}),{P109})').format('%')

    spreadsheet.select('P111').calc('1 / Math.pow((1 + {J58}),(({P5}-{J5})/365))').format('%')
    spreadsheet.select('P112').calc('1 / Math.pow((1 + {N58}),(({P5}-{J5})/365))').format('%')


    // Fair value per share reconciliation
    spreadsheet.select('J116:N116').merge().insert(['Exit Method']).addClass('col_merge')
    spreadsheet.select('J117:N117').insert(['EBITDA Multiple', '', 'Revenue Multiple', 'Terminal Growth Rate', 'P/E Multiple']).addClass('col_merge')
    
    // EBITDA Exit
    spreadsheet.select('J118').calc('{J107} * {L111} + {M107} * {M111} + {N107} * {N111} + {O107} * {O111} + {P107} * {P111}').format('#')
    spreadsheet.select('J119').calc('{J57}*{P43}*{P112}').format('#')
    spreadsheet.select('J120').calc('{J118} + {J119}').format('$')
    spreadsheet.select('J121:J126').insert(equity_waterfall).format('#')
    spreadsheet.select('J127').calc('Math.max({J120} + {J121} + {J122} + {J123} + {J124} + {J125} + {J126}, 0)').format('$')
    spreadsheet.select('J128').insert(shares_outstanding).format('#')
    spreadsheet.select('J129').calc('{J127} / {J128}').format('$$')


    // Revenue Exit
    spreadsheet.select('L118').calc('{J107} * {L111} + {M107} * {M111} + {N107} * {N111} + {O107} * {O111} + {P107} * {P111}').format('#')
    spreadsheet.select('L119').calc('{L57}*{P27}*{P112}').format('#')
    spreadsheet.select('L120').calc('{L118} + {L119}').format('$')
    spreadsheet.select('L121:L126').insert(equity_waterfall).format('#')
    spreadsheet.select('L127').calc('Math.max({L120} + {L121} + {L122} + {L123} + {L124} + {L125} + {L126}, 0)').format('$')
    spreadsheet.select('L128').insert(shares_outstanding).format('#')
    spreadsheet.select('L129').calc('{L127} / {L128}').format('$$')


    // Terminal Growth Exit
    spreadsheet.select('M118').calc('{J107} * {L111} + {M107} * {M111} + {N107} * {N111} + {O107} * {O111} + {P107} * {P111}').format('#')
    spreadsheet.select('M119').calc('{Q107}*(1+{M57})/({M58}-{M57})*{P112}+{P96}*{F79}*.2').format('#')
    spreadsheet.select('M120').calc('{M118} + {M119}').format('$')
    spreadsheet.select('M121:M126').insert(equity_waterfall).format('#')
    spreadsheet.select('M127').calc('Math.max({M120} + {M121} + {M122} + {M123} + {M124} + {M125} + {M126}, 0)').format('$')
    spreadsheet.select('M128').insert(shares_outstanding).format('#')
    spreadsheet.select('M129').calc('{M127} / {M128}').format('$$')


    // PE Exit
    spreadsheet.select('N118').calc('{J107} * {L111} + {M107} * {M111} + {N107} * {N111} + {O107} * {O111} + {P107} * {P111}').format('#')
    spreadsheet.select('N119').calc('{N120}-{N118}').format('#')
    spreadsheet.select('N120').calc('{N127} - {N121} - {N122} - {N123} - {N124} - {N125} - {N126}').format('$')
    spreadsheet.select('N121:N126').insert(equity_waterfall).format('#')
    spreadsheet.select('N127').calc('{N129} * {N128}').format('$')
    spreadsheet.select('N128').insert(shares_outstanding).format('#')
    spreadsheet.select('N129').calc('Math.max({P80}/{N128}*{N57}*{P112}, 0)').format('$$')

    // DCF NOL
    spreadsheet.select('J136').insert([0])
    // - begining balances
    spreadsheet.select('L133').calc('{J136}')
    spreadsheet.select('M133').calc('{L136}')
    spreadsheet.select('N133').calc('{M136}')
    spreadsheet.select('O133').calc('{N136}')
    spreadsheet.select('P133').calc('{O136}')

    // // - additions balances
    // spreadsheet.select('J134').calc('0')
    // spreadsheet.select('L134').calc('0')
    // spreadsheet.select('M134').calc('0')
    // spreadsheet.select('N134').calc('0')
    // spreadsheet.select('O134').calc('0')

    // // - usaage balances
    // spreadsheet.select('J135').calc('0')
    // spreadsheet.select('L135').calc('0')
    // spreadsheet.select('M135').calc('0')
    // spreadsheet.select('N135').calc('0')
    // spreadsheet.select('O135').calc('0')

    // - ending balances
    spreadsheet.select('J136').calc('{J133} + {J134} + {J135}')
    spreadsheet.select('L136').calc('{L133} + {L134} + {L135}')
    spreadsheet.select('M136').calc('{M133} + {M134} + {M135}')
    spreadsheet.select('N136').calc('{N133} + {N134} + {N135}')
    spreadsheet.select('O136').calc('{O133} + {O134} + {O135}')
    spreadsheet.select('P136').calc('{P133} + {P134} + {P135}')


    console.time('select')

    spreadsheet.select('G, K').width(10).addClass('whiteout')
    spreadsheet.select('1, 2 ,5, 18, 29, 31, 34, 37, 40, 42, 45, 50').height(0).addClass('whiteout')
    spreadsheet.select('117').height(30)

    console.timeEnd('select')

    // bold
    console.time('select bunch');

    spreadsheet.select('7, 9, 17, 19, 27, 32, 38, 43, 46, 49, 51, 53, 55, 59, 62, 64, 68, 69, 70, 71, 72, 74, 76, 78, 80, 82, 89, 101, 103, 107, 120, 127, 129').addClass('totals')

    console.timeEnd('select bunch');

    spreadsheet.select('F74, F76, F78, F85').addClass('input_heading')

    spreadsheet.select('6, 99').addClass('titles')
    spreadsheet.select('B7:P7').addClass('titles')
    spreadsheet.select('H100:Q100').addClass('titles')

    console.time('select last')
    
    spreadsheet.select('J101, J103, J107').format('$')
    spreadsheet.select('H76:P76, H78:P78, H80:P80, H103:Q103, I107:Q107, J1120:N1120, J127:N127, J129:N129').addClass('total_border')
    
    console.timeEnd('select last')



    function years(arr) {
      return arr.map(function(item) {
        return 'Year ' + item;
      })
    }

  </script>
</body>
</html>
